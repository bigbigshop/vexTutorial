---
title: 6.5 Boomerang Controller
sidebar_position: 5
description: 學習 Boomerang 演算法，讓機器人不僅能精準到達座標，還能以優美的弧線自動修正最終朝向。
---

## **前情提要**
在 6.4 章，我們學習了 Pure Pursuit，它讓機器人能流暢地跑完路徑。但 Pure Pursuit 有一個弱點：它很難精確控制機器人抵達終點時的**最終角度 (Heading)**。

在比賽中，我們經常需要機器人行去某個位，**同時**轉好角度準備吸波或掛籃。如果分開兩步做（行完再轉）太慢了。這一章，我們要介紹 LemLib 的核心黑科技 —— **Boomerang Controller (迴力鏢控制器)**。

---

## **1. 為什麼叫「迴力鏢」？**

傳統的 PID 或 Pure Pursuit 在接近目標點時，如果發現角度不對，往往會原地僵硬地轉向。

**Boomerang 演算法** 的邏輯不同：它會在目標點的前方，動態計算一個「虛擬目標點」（我們稱之為 **Carrot Point / 紅蘿蔔點**）。機器人會像追逐紅蘿蔔一樣，行出一條像「迴力鏢」一樣的優美弧線，最終完美地以預定角度滑入目標位置。



---

## **2. 核心演算法邏輯**

Boomerang 控制器結合了 **PID 控制** 與 **動態前瞻邏輯**。其運作流程如下：

### **第一步：設定目標姿態 (Target Pose)**
你不再只是給機器人一個 $(X, Y)$，而是給予一個 **Pose**：$(X, Y, \theta)$。
* $(X, Y)$：目的地座標。
* $\theta$：到達目的地時的最終朝向。

### **第二步：計算虛擬目標點 (The Carrot)**
演算法會根據機器人目前的位移誤差，在目標點前方距離 $d$ 的位置投射一個虛擬點。
* **公式思維：** $Carrot\_Pos = Target\_Pos - (\text{Heading\_Vector} \times Lead\_Distance)$
* 當機器人離目標很遠時，它會直接朝向目標衝過去。
* 當機器人接近目標時，它會受「紅蘿蔔」牽引，開始擺尾，繞出弧線來符合最終角度。

### **第三步：側向飄移補償 (Drift Compensation)**
在過彎時，演算法會根據速度動態調整左右輪電力，確保機器人不會因為慣性而甩出弧線之外。

---

## **3. 關鍵參數解密**

在實作（如使用 `moveToPose`）時，有幾個參數決定了 Boomerang 的表現：

| 參數 | 作用 | 調校建議 |
| :--- | :--- | :--- |
| **Lead (前導量)** | 決定弧線有多「彎」。 | 數值 0-1 之間。0 代表行直線；0.6 是黃金比例；1 則會繞大圈。 |
| **Min Speed** | 抵達目標前的最低速度。 | 設為非 0 值可實現「衝過目標」的連續動作銜接。 |
| **Horizontal Drift** | 處理過彎時的橫向偏離。 | 通常設定在 2-15 之間，視乎底盤重心而定。 |



---

## **4. Boomerang vs. Pure Pursuit**

| 特性 | Pure Pursuit | Boomerang |
| :--- | :--- | :--- |
| **目標控制** | 只能控制 $(X, Y)$ | 同時控制 $(X, Y, \theta)$ |
| **路徑靈活性** | 適合長距離、多點連線 | 適合單次精準定位、準備射球/掛籃 |
| **停位精度** | 終點角度較隨機 | 終點角度極度精準 |

---

## **🎤 評審面談實戰 (Judges Interview)**

**Q1. 你們如何確保機器人在抵達自動線（Auton Line）時，車頭剛好對準籃框？**
*(考察重點：姿態控制 Pose Control)*

**🧐 回答範例：**
「我們採用了 **Boomerang Controller**。與傳統只針對座標移動的 PID 不同，Boomerang 會在目標點前方動態生成一個『虛擬前瞻點』。這讓機器機能在移動過程中，同時修正位置誤差與航向偏差。最終，機器人會以一條平滑的弧線切入目標，無需在到達後再做二次轉向修正，大幅節省了自動時段的寶貴時間。」

**Q2. 調整 Lead（前導參數）時，你們學到了什麼？**
*(考察重點：工程權衡 Engineering Trade-off)*

**🧐 回答範例：**
「我們發現 Lead 參數直接影響了路徑的曲率。當 Lead 設定過高時，機器人會為了追求完美的最終角度而繞大圈，甚至可能撞到場地障礙物；若 Lead 太低，路徑會變得很直，導致最後轉向動作生硬。我們通過反覆測試，將 Lead 鎖定在 0.6，這在移動速度與姿態精度之間取得了最佳平衡。」

---

## **🏆 模組 6 結語：演算法的奧秘**

恭喜你完成了第六單元的所有演算法學習！
* ✅ **PID**：學會了精準停位。
* ✅ **Odometry**：為機器人裝上了導航系統。
* ✅ **Pure Pursuit**：實現了多點流暢路徑。
* ✅ **Boomerang**：達成了位置與角度的完美統一。

**下一章預告：模組 7 冠軍軟實力**
技術固然重要，但如何將這些複雜的演算法寫入工程筆記，並在面試中讓評審留下深刻印象？我們下一章見。